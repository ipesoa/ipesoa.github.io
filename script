document.addEventListener('DOMContentLoaded', () => {
    const input = document.getElementById('codeInput');
    const btn = document.getElementById('goBtn');
    const errorMsg = document.getElementById('error-msg');

    // 1. Configuración: Salt personalizada. 
    // Cambia esto por una frase larga y aleatoria única para ti.
    // Esto evita que alguien use tablas hash genéricas para adivinar tus códigos.
    const SITE_SALT = "noticias-ipesoa-proyecto-secreto-2025-v1";

    async function handleRedirect() {
        const rawCode = input.value.trim().toLowerCase(); // Normalizamos a minúsculas
        
        if (!rawCode) return;

        // 2. Generar Hash SHA-256
        const encoder = new TextEncoder();
        const data = encoder.encode(rawCode + SITE_SALT);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        
        // Convertir buffer a cadena Hexadecimal
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');

        // 3. Redirección
        // Intentamos cargar la página. Si no existe, GitHub Pages mostrará su 404.
        // Opcional: Podrías hacer un fetch() primero para verificar si existe, 
        // pero redirigir directamente es más rápido y seguro.
        
        window.location.href = `/p/${hashHex}.html`;
    }

    // Event Listeners
    btn.addEventListener('click', handleRedirect);
    input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleRedirect();
    });
});
